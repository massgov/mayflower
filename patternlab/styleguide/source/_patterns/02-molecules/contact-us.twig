{% set outerAccordion = contactUs.accordion %}

{% if outerAccordion %}
  {% set accordionClass = "ma__contact-us--accordion js-accordion" %}
{% else %}
  {% if contactUs.groups|length > 2 or contactUs.showMore %}
    {% set accordionClass = "js-accordion" %}
    {% set inlineAccordion = true %}
  {% endif %}
{% endif %}

{% set contactUsHeading = contactUs.level ? : 2 %}
<section
  class="ma__contact-us {{ accordionClass }} {{ contactUs.isExpanded ? 'is-open':'' }} {{ contactUs.columns ? 'ma__contact-us--columns':'' }}">
  {% if contactUs.subTitle %}
    <h{{ contactUsHeading }} class="ma__column-heading">
    {% if outerAccordion %}
      <button class="ma__contact-us__header js-accordion-link" type="button">
    {% endif %}
    {% if contactUs.subTitle.href %}
      {% set decorativeLink = contactUs.subTitle %}
      {% include "@atoms/decorative-link.twig" %}
    {% else %}
      <span class="ma__contact-us__header__label">{{contactUs.subTitle.text}}</span>
    {% endif %}
    {% if outerAccordion %}
      <span class="ma__contact-us--accordion__status js-accordion-status" aria-hidden="true">+</span>
      </button>
    {% endif %}
    </h{{ contactUsHeading }}>
    {% set groupHeading = contactUsHeading + 1 %}
    {% set contactName = contactUs.subTitle.text %}
  {% endif %}

  {% block contactGroups %}
    {% if inlineAccordion %}
      {% block primaryContactGroups %}
        {# Show first 2 contact groups outside of accordion #}
        {% for group in contactUs.groups[:2] %}
          {% set contactGroup = group|merge({
                               "level": groupHeading,
                               "contactName": contactName })  %}
          {% include "@molecules/contact-group.twig" %}
        {% endfor %}
      {% endblock %}

      {% if not contactUs.hideSecondary %}
        {# Show 3rd+ contact groups inside of accordion (if they exist) #}
        <div class="ma__contact-us__extra js-accordion-content">
          {% block secondaryContactGroups %}
            {% for group in contactUs.groups[2:last] %}
              {% set contactGroup = group|merge({
                                 "level": groupHeading,
                                 "contactName": contactName })  %}
              {% include "@molecules/contact-group.twig" %}
            {% endfor %}
          {% endblock %}
        </div>
        <div class="ma__contact-us__expand">
          <button type="button" class="js-accordion-link">
            <span>more</span><span>less</span> contact info
          </button>
        </div>
      {% endif %}
    {% else %}
      <div class="ma__contact-us__content js-accordion-content">
        <div class="ma__contact-us__content-wrap">
          {% for group in contactUs.groups %}
            {% set contactGroup = group|merge({
                             "level": groupHeading,
                             "contactName": contactName })  %}
            {% include "@molecules/contact-group.twig" %}
          {% endfor %}
          {% if contactUs.decorativeLink %}
            <div class="ma__contact-us__more-info">
              {% set decorativeLink = contactUs.decorativeLink %}
              {% include "@atoms/decorative-link.twig" %}
            </div>
          {% endif %}
        </div>
      </div>
    {% endif %}
  {% endblock %}
</section>
